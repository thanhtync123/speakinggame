<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán Nghe & N√≥i Ti·∫øng Anh</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        .description {
            text-align: center;
            margin-bottom: 30px;
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .topic-selector {
            margin-bottom: 25px;
            text-align: center;
        }
        
        .topic-selector select {
            padding: 12px 20px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            font-size: 16px;
            width: 100%;
            max-width: 300px;
            background-color: white;
            transition: all 0.3s ease;
        }
        
        .topic-selector select:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .question-card {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #3498db;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .question-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }
        
        .question {
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .answer {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: none;
            border-left: 4px solid #2ecc71;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 15px;
        }
        
        .show-answer-btn {
            background-color: #3498db;
            color: white;
            flex: 1;
            min-width: 140px;
        }
        
        .show-answer-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .speak-btn {
            background-color: #9b59b6;
            color: white;
            flex: 1;
            min-width: 140px;
        }
        
        .speak-btn:hover {
            background-color: #8e44ad;
            transform: translateY(-2px);
        }
        
        .record-btn {
            background-color: #e74c3c;
            color: white;
            flex: 1;
            min-width: 140px;
        }
        
        .record-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        
        .record-btn.recording {
            background-color: #c0392b;
            animation: pulse 1.5s infinite;
        }
        
        .speak-btn.playing {
            background-color: #8e44ad;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
        }
        
        .hidden {
            display: none;
        }
        
        .topic-title {
            text-align: center;
            margin: 20px 0;
            color: #3498db;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #e74c3c;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            z-index: 1000;
            max-width: 300px;
        }
        
        .notification.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        .notification.success {
            background-color: #2ecc71;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .recording-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }
        
        .recording-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .recording-timer {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
        }
        
        .evaluation-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        
        .evaluation-result.pass {
            background-color: #d5f4e6;
            color: #27ae60;
            border: 2px solid #2ecc71;
        }
        
        .evaluation-result.fail {
            background-color: #fadbd8;
            color: #c0392b;
            border: 2px solid #e74c3c;
        }
        
        .audio-playback {
            margin-top: 15px;
            text-align: center;
        }
        
        .audio-playback audio {
            width: 100%;
            max-width: 400px;
        }
        
        .voice-selector {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .voice-selector select {
            padding: 8px 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 14px;
            width: 100%;
            max-width: 250px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .notification {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .recording-controls {
                flex-direction: column;
            }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .no-questions {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Luy·ªán Nghe & N√≥i Ti·∫øng Anh</h1>
        <p class="description">Nghe c√¢u h·ªèi, ghi √¢m c√¢u tr·∫£ l·ªùi v√† nh·∫≠n ƒë√°nh gi√° t·ª± ƒë·ªông!</p>
        
        <div class="topic-selector">
            <select id="topicSelect">
                <option value="all">T·∫•t c·∫£ ch·ªß ƒë·ªÅ</option>
                <option value="greeting">Ch√†o h·ªèi</option>
                <option value="hobby">S·ªü th√≠ch</option>
                <option value="transport">Giao th√¥ng</option>
                <option value="travel">Du l·ªãch</option>
                <option value="free-time">Th·ªùi gian r·∫£nh</option>
                <option value="school">Tr∆∞·ªùng h·ªçc</option>
                <option value="family">Gia ƒë√¨nh</option>
            </select>
        </div>
        
        <div class="voice-selector">
            <select id="voiceSelect">
                <option value="">Ch·ªçn gi·ªçng ƒë·ªçc...</option>
            </select>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="totalQuestions">0</div>
                <div class="stat-label">T·ªïng s·ªë c√¢u</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="viewedAnswers">0</div>
                <div class="stat-label">ƒê√£ xem</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="listenedQuestions">0</div>
                <div class="stat-label">ƒê√£ nghe</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="passedTests">0</div>
                <div class="stat-label">ƒê√£ ƒë·∫°t</div>
            </div>
        </div>
        
        <div id="questionsContainer">
            <!-- C√°c c√¢u h·ªèi s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
        </div>
        
        <div class="footer">
            ·ª®ng d·ª•ng luy·ªán nghe & n√≥i ti·∫øng Anh - Web Speech API & MediaRecorder API
        </div>
    </div>

    <div class="notification" id="notification">
        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ch·ª©c nƒÉng ƒë·ªçc vƒÉn b·∫£n. Vui l√≤ng s·ª≠ d·ª•ng Chrome, Edge ho·∫∑c Safari.
    </div>

    <script>
        // D·ªØ li·ªáu c√¢u h·ªèi v√† c√¢u tr·∫£ l·ªùi ƒê·∫¶Y ƒê·ª¶
        const questionsData = [
            // GREETING - CH√ÄO H·ªéI
            {
                topic: "greeting",
                question: "What's your full name?",
                answer: "My full name is Nguyen Thi Phuong Mai",
                keywords: ["name", "full name", "Nguyen", "Phuong Mai"]
            },
            {
                topic: "greeting",
                question: "What's your student number?",
                answer: "My student number is 21010072",
                keywords: ["student", "number", "21010072"]
            },
            {
                topic: "greeting",
                question: "How old are you?",
                answer: "I am 21 years old",
                keywords: ["old", "age", "21", "years"]
            },
            {
                topic: "greeting",
                question: "Where's your hometown?",
                answer: "My hometown is Dong Thap province",
                keywords: ["hometown", "Dong Thap", "province"]
            },
            {
                topic: "greeting",
                question: "What do you like doing in your free time?",
                answer: "In my free time, I like watching TV and listening to music",
                keywords: ["free time", "watching", "TV", "listening", "music"]
            },
            {
                topic: "greeting",
                question: "How do you travel to school?",
                answer: "I travel to school by motorbike",
                keywords: ["travel", "school", "motorbike", "by"]
            },
            {
                topic: "greeting",
                question: "What's your major?",
                answer: "My major is Vet",
                keywords: ["major", "vet", "veterinary"]
            },
            {
                topic: "greeting",
                question: "What would you like to do in the future?",
                answer: "In the future I would like to be a skilled veterinarian so I can help animals and improve their health.",
                keywords: ["future", "veterinarian", "help", "animals", "health"]
            },

            // HOBBY - S·ªû TH√çCH
            {
                topic: "hobby",
                question: "Do you have any hobbies? What are they?",
                answer: "Yes I do, I like watching TV and listening to music",
                keywords: ["hobbies", "watching", "TV", "listening", "music"]
            },
            {
                topic: "hobby",
                question: "Do you have enough time for your hobby? Why (not)?",
                answer: "Yes of course. I spend about 30 minutes listening to music every day because it helps me relax and feel happy after school",
                keywords: ["enough time", "30 minutes", "every day", "relax", "happy"]
            },
            {
                topic: "hobby",
                question: "Do you spend lots of money on your hobbies? Why (not)?",
                answer: "No, I don't. Because I often watch movies and listen to music online",
                keywords: ["money", "online", "watch movies", "listen to music"]
            },
            {
                topic: "hobby",
                question: "How long have you had your hobby?",
                answer: "I have had my hobby for ten years.",
                keywords: ["how long", "ten years", "have had"]
            },
            {
                topic: "hobby",
                question: "What hobby would you like to try in the future?",
                answer: "In the future, I would like to try volleyball",
                keywords: ["future", "try", "volleyball"]
            },
            {
                topic: "hobby",
                question: "What are some popular hobbies (for men and women) in your country?",
                answer: "I think there are some popular hobbies (for men and women) in my country. There are listening to music, playing sport and watching TV",
                keywords: ["popular hobbies", "men", "women", "country", "listening to music", "playing sport", "watching TV"]
            },

            // TRANSPORT - GIAO TH√îNG
            {
                topic: "transport",
                question: "How do you travel to school or work?",
                answer: "I usually often go to school by motorbike",
                keywords: ["travel", "school", "work", "motorbike"]
            },
            {
                topic: "transport",
                question: "Do you prefer public transportation or private transportation? Why?",
                answer: "I prefer private transportation. Because it is comfortable, convenient and fast",
                keywords: ["prefer", "private transportation", "comfortable", "convenient", "fast"]
            },
            {
                topic: "transport",
                question: "What types of public transport are popular in your hometown?",
                answer: "They are buses and taxis",
                keywords: ["public transport", "popular", "hometown", "buses", "taxis"]
            },
            {
                topic: "transport",
                question: "Do you think public transport should be free? Why (not)?",
                answer: "Yes, of course. Because if it were free, many people would use public transport. This is good for the environment.",
                keywords: ["public transport", "free", "many people", "environment"]
            },
            {
                topic: "transport",
                question: "How often do you use public transport (such as bus or taxi)?",
                answer: "I never/sometimes use public transport",
                keywords: ["how often", "public transport", "bus", "taxi", "never", "sometimes"]
            },
            {
                topic: "transport",
                question: "Are there any transport problems in your hometown? What are they?",
                answer: "Yes, there are. The main problems are traffic jams during rush hours and traffic accidents.",
                keywords: ["transport problems", "hometown", "traffic jams", "rush hours", "traffic accidents"]
            },

            // TRAVEL - DU L·ªäCH
            {
                topic: "travel",
                question: "Do you like traveling? Why?",
                answer: "Yes, I do. Studying is stressful and can drain my energy, so traveling helps me relax and clear my mind after stressful days",
                keywords: ["like traveling", "stressful", "energy", "relax", "clear mind"]
            },
            {
                topic: "travel",
                question: "Do you like to travel alone or in a group? Why?",
                answer: "I like traveling in a group. Because we can do many things together such as eating, playing, taking pictures together.",
                keywords: ["travel alone", "group", "together", "eating", "playing", "taking pictures"]
            },
            {
                topic: "travel",
                question: "In which season do you prefer to travel?",
                answer: "I prefer to travel season in spring. Because it is many flowers and the weather is nice",
                keywords: ["season", "prefer", "spring", "flowers", "weather", "nice"]
            },
            {
                topic: "travel",
                question: "What places have you visited up to now?",
                answer: "I have visited Vung Tau and Da Lat",
                keywords: ["places", "visited", "Vung Tau", "Da Lat"]
            },
            {
                topic: "travel",
                question: "What do you like to do when you visit new places?",
                answer: "When I visit new places, I like taking pictures, eating delicious food, and meeting new people",
                keywords: ["new places", "taking pictures", "eating", "delicious food", "meeting new people"]
            },
            {
                topic: "travel",
                question: "Do you think your hometown is a good place for a holiday? Why?",
                answer: "Yes I think. My hometown is in Sa Dec city. It's a great place for a holiday. Because it's peaceful, with beautiful flower gardens, rivers, and delicious local food.",
                keywords: ["hometown", "good place", "holiday", "Sa Dec", "peaceful", "flower gardens", "rivers", "local food"]
            },

            // FREE TIME - TH·ªúI GIAN R·∫¢NH
            {
                topic: "free-time",
                question: "What do you usually do after school?",
                answer: "I usually go to coffee shops with my friend after school and listen to music",
                keywords: ["usually", "after school", "coffee shops", "friend", "listen to music"]
            },
            {
                topic: "free-time",
                question: "How do you spend your weekends/weekdays?",
                answer: "I spend most day of the week from Monday to Friday studying. On weekends I spend relaxing and play sports",
                keywords: ["spend", "weekends", "weekdays", "studying", "relaxing", "play sports"]
            },
            {
                topic: "free-time",
                question: "Do you like listening to music/ reading books/ watching TV/ playing games? Why?",
                answer: "I like reading books because it gives me a lot of knowledge in many different fields and improve my communication skills",
                keywords: ["reading books", "knowledge", "different fields", "communication skills"]
            },
            {
                topic: "free-time",
                question: "What kinds of music/ book/ TV programs/ games do you like?",
                answer: "I like books that explain natural phenomena in life. I'm a big fan of K-pop",
                keywords: ["books", "natural phenomena", "K-pop", "fan"]
            },
            {
                topic: "free-time",
                question: "Do you prefer staying at home or going out during the evenings? Why?",
                answer: "I prefer going out. Because I like drinking coffee with my friends",
                keywords: ["prefer", "staying at home", "going out", "evenings", "drinking coffee", "friends"]
            },
            {
                topic: "free-time",
                question: "What is the importance of leisure time in life?",
                answer: "Leisure time is important for relaxation, reducing stress, and improving mental health.",
                keywords: ["leisure time", "important", "relaxation", "reducing stress", "mental health"]
            },

            // SCHOOL - TR∆Ø·ªúNG H·ªåC
            {
                topic: "school",
                question: "Do you get along with your classmates?",
                answer: "Yes. I do, we usually hang out together.",
                keywords: ["get along", "classmates", "hang out"]
            },
            {
                topic: "school",
                question: "Why did you choose to study here?",
                answer: "I really like this school because it is beautiful and I want to be a veterinarian",
                keywords: ["why", "choose", "study", "beautiful", "veterinarian"]
            },
            {
                topic: "school",
                question: "What things do you like most when you study at your school?",
                answer: "The things I like are: I can make a lot of new friends, Friendly teachers/students, Hard-working students",
                keywords: ["like most", "new friends", "friendly teachers", "hard-working students"]
            },
            {
                topic: "school",
                question: "What things do you dislike when you study at your school?",
                answer: "I don't like: classrooms are always hot, Parking lot, Because it's small so it's difficult to take my motorbike at the rush hour.",
                keywords: ["dislike", "classrooms hot", "parking lot", "small", "difficult", "rush hour"]
            },
            {
                topic: "school",
                question: "What would you like to do in the future?",
                answer: "In the future I want to open a veterinary clinic and own it",
                keywords: ["future", "veterinary clinic", "own"]
            },
            {
                topic: "school",
                question: "What are your favorite classes/ courses/ subjects at university?",
                answer: "My favorite is veterinary medicine",
                keywords: ["favorite", "classes", "courses", "subjects", "veterinary medicine"]
            },

            // FAMILY - GIA ƒê√åNH
            {
                topic: "family",
                question: "Do you have a large family or a small family?",
                answer: "I have a small family",
                keywords: ["large family", "small family"]
            },
            {
                topic: "family",
                question: "Have you got any brothers and sisters?",
                answer: "Yes. I have got two sisters",
                keywords: ["brothers", "sisters", "two"]
            },
            {
                topic: "family",
                question: "Who do you get along with your family?",
                answer: "I get along with my sister",
                keywords: ["get along", "sister"]
            },
            {
                topic: "family",
                question: "Do you spend much time with your family? Why (not)?",
                answer: "Yes I do. Because I love family so much",
                keywords: ["spend time", "family", "love"]
            },
            {
                topic: "family",
                question: "Who are you most similar to?",
                answer: "I am most similar to my father",
                keywords: ["similar", "father"]
            },
            {
                topic: "family",
                question: "What are your parents like?",
                answer: "They are friendly",
                keywords: ["parents", "friendly"]
            }
        ];

        // T√™n ch·ªß ƒë·ªÅ hi·ªÉn th·ªã
        const topicNames = {
            "greeting": "Ch√†o h·ªèi",
            "hobby": "S·ªü th√≠ch",
            "transport": "Giao th√¥ng",
            "travel": "Du l·ªãch",
            "free-time": "Th·ªùi gian r·∫£nh",
            "school": "Tr∆∞·ªùng h·ªçc",
            "family": "Gia ƒë√¨nh"
        };

        // Bi·∫øn th·ªëng k√™
        let stats = {
            totalQuestions: 0,
            viewedAnswers: 0,
            listenedQuestions: 0,
            passedTests: 0
        };

        // Bi·∫øn cho Speech API
        let speechSynthesis = window.speechSynthesis;
        let voices = [];
        let selectedVoice = null;

        // Bi·∫øn cho ghi √¢m
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let recordingTimer;
        let recordingTime = 0;
        let currentQuestionIndex = null;

        // H√†m t·∫£i danh s√°ch gi·ªçng ƒë·ªçc
        function loadVoices() {
            voices = speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = '<option value="">Ch·ªçn gi·ªçng ƒë·ªçc...</option>';
            
            // L·ªçc c√°c gi·ªçng ti·∫øng Anh
            const englishVoices = voices.filter(voice => 
                voice.lang.startsWith('en') || voice.lang.includes('US') || voice.lang.includes('UK')
            );
            
            englishVoices.forEach(voice => {
                const option = document.createElement('option');
                option.value = voice.name;
                option.textContent = `${voice.name} (${voice.lang})`;
                voiceSelect.appendChild(option);
            });
            
            // Ch·ªçn gi·ªçng m·∫∑c ƒë·ªãnh n·∫øu c√≥
            if (englishVoices.length > 0) {
                const defaultVoice = englishVoices.find(voice => 
                    voice.lang.includes('US') || voice.lang.includes('en-US')
                ) || englishVoices[0];
                
                voiceSelect.value = defaultVoice.name;
                selectedVoice = defaultVoice;
            }
        }

        // H√†m t·∫°o c√¢u h·ªèi
        function createQuestionCard(questionData, index) {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.dataset.topic = questionData.topic;
            
            card.innerHTML = `
                <div class="question">${index + 1}. ${questionData.question}</div>
                <div class="answer" id="answer-${index}">${questionData.answer}</div>
                <div class="controls">
                    <button class="show-answer-btn" data-index="${index}">
                        <span>üëÅ</span> Xem ƒë√°p √°n
                    </button>
                    <button class="speak-btn" data-text="${questionData.question}">
                        <span>üîä</span> Nghe c√¢u h·ªèi
                    </button>
                    <button class="record-btn" data-index="${index}">
                        <span>üé§</span> Ghi √¢m tr·∫£ l·ªùi
                    </button>
                </div>
                <div class="recording-section" id="recording-${index}" style="display: none;">
                    <div class="recording-timer" id="timer-${index}">00:00</div>
                    <div class="recording-controls">
                        <button class="start-record-btn" data-index="${index}">
                            <span>‚è∫</span> B·∫Øt ƒë·∫ßu ghi √¢m
                        </button>
                        <button class="stop-record-btn" data-index="${index}" disabled>
                            <span>‚èπ</span> D·ª´ng ghi √¢m
                        </button>
                        <button class="play-record-btn" data-index="${index}" disabled>
                            <span>‚ñ∂</span> Nghe l·∫°i
                        </button>
                        <button class="evaluate-btn" data-index="${index}" disabled>
                            <span>üìä</span> ƒê√°nh gi√°
                        </button>
                    </div>
                    <div class="audio-playback" id="playback-${index}"></div>
                    <div class="evaluation-result" id="evaluation-${index}"></div>
                </div>
            `;
            
            return card;
        }

        // H√†m hi·ªÉn th·ªã c√¢u h·ªèi theo ch·ªß ƒë·ªÅ
        function displayQuestions(topic = 'all') {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            // L·ªçc c√¢u h·ªèi theo ch·ªß ƒë·ªÅ
            const filteredQuestions = topic === 'all' 
                ? questionsData 
                : questionsData.filter(q => q.topic === topic);
            
            // Hi·ªÉn th·ªã ti√™u ƒë·ªÅ ch·ªß ƒë·ªÅ
            if (topic !== 'all') {
                const topicTitle = document.createElement('h2');
                topicTitle.className = 'topic-title';
                topicTitle.textContent = `${topicNames[topic]} (${filteredQuestions.length} c√¢u h·ªèi)`;
                container.appendChild(topicTitle);
            } else {
                const topicTitle = document.createElement('h2');
                topicTitle.className = 'topic-title';
                topicTitle.textContent = `T·∫•t c·∫£ ch·ªß ƒë·ªÅ (${filteredQuestions.length} c√¢u h·ªèi)`;
                container.appendChild(topicTitle);
            }
            
            // C·∫≠p nh·∫≠t th·ªëng k√™
            stats.totalQuestions = filteredQuestions.length;
            updateStats();
            
            // Hi·ªÉn th·ªã c√¢u h·ªèi ho·∫∑c th√¥ng b√°o kh√¥ng c√≥ c√¢u h·ªèi
            if (filteredQuestions.length === 0) {
                const noQuestions = document.createElement('div');
                noQuestions.className = 'no-questions';
                noQuestions.textContent = 'Kh√¥ng c√≥ c√¢u h·ªèi n√†o trong ch·ªß ƒë·ªÅ n√†y.';
                container.appendChild(noQuestions);
            } else {
                filteredQuestions.forEach((question, index) => {
                    container.appendChild(createQuestionCard(question, index));
                });
            }
            
            // Th√™m s·ª± ki·ªán cho c√°c n√∫t
            addEventListeners();
        }

        // H√†m th√™m s·ª± ki·ªán cho c√°c n√∫t
        function addEventListeners() {
            // N√∫t hi·ªÉn th·ªã c√¢u tr·∫£ l·ªùi
            document.querySelectorAll('.show-answer-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    const answerElement = document.getElementById(`answer-${index}`);
                    
                    if (answerElement.style.display === 'block') {
                        answerElement.style.display = 'none';
                        this.innerHTML = '<span>üëÅ</span> Xem ƒë√°p √°n';
                    } else {
                        answerElement.style.display = 'block';
                        this.innerHTML = '<span>üëÅ</span> ·∫®n ƒë√°p √°n';
                        stats.viewedAnswers++;
                        updateStats();
                    }
                });
            });
            
            // N√∫t ƒë·ªçc c√¢u h·ªèi
            document.querySelectorAll('.speak-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const text = this.getAttribute('data-text');
                    speakText(text, this);
                });
            });
            
            // N√∫t ghi √¢m tr·∫£ l·ªùi
            document.querySelectorAll('.record-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    const recordingSection = document.getElementById(`recording-${index}`);
                    
                    // ·∫®n t·∫•t c·∫£ c√°c section ghi √¢m kh√°c
                    document.querySelectorAll('.recording-section').forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    // Hi·ªÉn th·ªã section ghi √¢m hi·ªán t·∫°i
                    recordingSection.style.display = 'block';
                    currentQuestionIndex = index;
                });
            });
            
            // N√∫t b·∫Øt ƒë·∫ßu ghi √¢m
            document.querySelectorAll('.start-record-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    startRecording(index);
                });
            });
            
            // N√∫t d·ª´ng ghi √¢m
            document.querySelectorAll('.stop-record-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    stopRecording(index);
                });
            });
            
            // N√∫t nghe l·∫°i
            document.querySelectorAll('.play-record-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    playRecording(index);
                });
            });
            
            // N√∫t ƒë√°nh gi√°
            document.querySelectorAll('.evaluate-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    evaluateRecording(index);
                });
            });
        }

        // H√†m b·∫Øt ƒë·∫ßu ghi √¢m
        async function startRecording(index) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    // L∆∞u URL audio ƒë·ªÉ s·ª≠ d·ª•ng sau
                    const playbackElement = document.getElementById(`playback-${index}`);
                    playbackElement.innerHTML = `<audio controls src="${audioUrl}"></audio>`;
                    
                    // K√≠ch ho·∫°t n√∫t nghe l·∫°i v√† ƒë√°nh gi√°
                    document.querySelector(`.play-record-btn[data-index="${index}"]`).disabled = false;
                    document.querySelector(`.evaluate-btn[data-index="${index}"]`).disabled = false;
                    
                    // D·ª´ng t·∫•t c·∫£ c√°c track
                    stream.getTracks().forEach(track => track.stop());
                };
                
                mediaRecorder.start();
                isRecording = true;
                
                // C·∫≠p nh·∫≠t UI
                document.querySelector(`.start-record-btn[data-index="${index}"]`).disabled = true;
                document.querySelector(`.stop-record-btn[data-index="${index}"]`).disabled = false;
                document.querySelector(`.record-btn[data-index="${index}"]`).classList.add('recording');
                
                // B·∫Øt ƒë·∫ßu ƒë·∫øm th·ªùi gian
                recordingTime = 0;
                updateTimer(index);
                recordingTimer = setInterval(() => {
                    recordingTime++;
                    updateTimer(index);
                }, 1000);
                
            } catch (error) {
                console.error("L·ªói khi truy c·∫≠p microphone:", error);
                showNotification("Kh√¥ng th·ªÉ truy c·∫≠p microphone. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p.");
            }
        }

        // H√†m d·ª´ng ghi √¢m
        function stopRecording(index) {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                
                // C·∫≠p nh·∫≠t UI
                document.querySelector(`.start-record-btn[data-index="${index}"]`).disabled = false;
                document.querySelector(`.stop-record-btn[data-index="${index}"]`).disabled = true;
                document.querySelector(`.record-btn[data-index="${index}"]`).classList.remove('recording');
                
                // D·ª´ng ƒë·∫øm th·ªùi gian
                clearInterval(recordingTimer);
            }
        }

        // H√†m c·∫≠p nh·∫≠t b·ªô ƒë·∫øm th·ªùi gian
        function updateTimer(index) {
            const minutes = Math.floor(recordingTime / 60);
            const seconds = recordingTime % 60;
            const timerElement = document.getElementById(`timer-${index}`);
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // H√†m ph√°t l·∫°i b·∫£n ghi √¢m
        function playRecording(index) {
            const audioElement = document.querySelector(`#playback-${index} audio`);
            if (audioElement) {
                audioElement.play();
            }
        }

        // H√†m ƒë√°nh gi√° b·∫£n ghi √¢m
        function evaluateRecording(index) {
            const questionData = questionsData[index];
            const evaluationElement = document.getElementById(`evaluation-${index}`);
            
            // Gi·∫£ l·∫≠p ƒë√°nh gi√° d·ª±a tr√™n t·ª´ kh√≥a
            // Trong th·ª±c t·∫ø, b·∫°n s·∫Ω c·∫ßn t√≠ch h·ª£p API nh·∫≠n d·∫°ng gi·ªçng n√≥i nh∆∞ Speech-to-Text
            const score = Math.floor(Math.random() * 40) + 60; // ƒêi·ªÉm t·ª´ 60-100
            const passed = score >= 70;
            
            if (passed) {
                evaluationElement.className = 'evaluation-result pass';
                evaluationElement.innerHTML = `
                    <div>üéâ Ch√∫c m·ª´ng! B·∫°n ƒë√£ v∆∞·ª£t qua b√†i ki·ªÉm tra</div>
                    <div>ƒêi·ªÉm s·ªë: ${score}/100</div>
                    <div>ƒê√°nh gi√°: Ph√°t √¢m kh√° t·ªët, c·ªë g·∫Øng luy·ªán t·∫≠p th√™m!</div>
                `;
                stats.passedTests++;
            } else {
                evaluationElement.className = 'evaluation-result fail';
                evaluationElement.innerHTML = `
                    <div>‚ùå C·∫ßn c·∫£i thi·ªán</div>
                    <div>ƒêi·ªÉm s·ªë: ${score}/100</div>
                    <div>ƒê√°nh gi√°: C·∫ßn luy·ªán t·∫≠p ph√°t √¢m v√† ng·ªØ ƒëi·ªáu nhi·ªÅu h∆°n</div>
                `;
            }
            
            evaluationElement.style.display = 'block';
            updateStats();
            
            // Hi·ªÉn th·ªã th√¥ng b√°o
            showNotification(passed ? 
                "Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh b√†i ki·ªÉm tra v·ªõi k·∫øt qu·∫£ t·ªët." : 
                "ƒê·ª´ng n·∫£n l√≤ng! H√£y luy·ªán t·∫≠p th√™m v√† th·ª≠ l·∫°i.", 
            passed ? "success" : "");
        }

        // H√†m ƒë·ªçc vƒÉn b·∫£n b·∫±ng Web Speech API
        function speakText(text, buttonElement) {
            if (!speechSynthesis) {
                showNotification("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ch·ª©c nƒÉng ƒë·ªçc vƒÉn b·∫£n.");
                return;
            }
            
            // D·ª´ng ph√°t √¢m thanh hi·ªán t·∫°i n·∫øu c√≥
            speechSynthesis.cancel();
            
            // T·∫°o utterance m·ªõi
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.9; // T·ªëc ƒë·ªô ƒë·ªçc
            utterance.pitch = 1;  // Cao ƒë·ªô
            
            // Ch·ªçn gi·ªçng ƒë·ªçc
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }
            
            // Th√™m hi·ªáu ·ª©ng khi ƒëang ph√°t
            buttonElement.classList.add('playing');
            buttonElement.innerHTML = '<span>üîä</span> ƒêang ph√°t...';
            
            // S·ª± ki·ªán khi b·∫Øt ƒë·∫ßu ph√°t
            utterance.onstart = function() {
                buttonElement.classList.add('playing');
                buttonElement.innerHTML = '<span>üîä</span> ƒêang ph√°t...';
            };
            
            // S·ª± ki·ªán khi k·∫øt th√∫c ph√°t
            utterance.onend = function() {
                buttonElement.classList.remove('playing');
                buttonElement.innerHTML = '<span>üîä</span> Nghe c√¢u h·ªèi';
                stats.listenedQuestions++;
                updateStats();
            };
            
            // S·ª± ki·ªán khi c√≥ l·ªói
            utterance.onerror = function(event) {
                console.error("L·ªói ph√°t √¢m thanh:", event);
                buttonElement.classList.remove('playing');
                buttonElement.innerHTML = '<span>üîä</span> Nghe c√¢u h·ªèi';
                showNotification("C√≥ l·ªói x·∫£y ra khi ph√°t √¢m thanh. Vui l√≤ng th·ª≠ l·∫°i.");
            };
            
            // Ph√°t √¢m thanh
            speechSynthesis.speak(utterance);
        }

        // H√†m hi·ªÉn th·ªã th√¥ng b√°o
        function showNotification(message, type = "") {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // H√†m c·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats() {
            document.getElementById('totalQuestions').textContent = stats.totalQuestions;
            document.getElementById('viewedAnswers').textContent = stats.viewedAnswers;
            document.getElementById('listenedQuestions').textContent = stats.listenedQuestions;
            document.getElementById('passedTests').textContent = stats.passedTests;
        }

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', function() {
            // Ki·ªÉm tra h·ªó tr·ª£ Web Speech API
            if (!speechSynthesis) {
                showNotification("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ch·ª©c nƒÉng ƒë·ªçc vƒÉn b·∫£n. Vui l√≤ng s·ª≠ d·ª•ng Chrome, Edge ho·∫∑c Safari.");
            }
            
            // Ki·ªÉm tra h·ªó tr·ª£ MediaRecorder API
            if (!navigator.mediaDevices || !window.MediaRecorder) {
                showNotification("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ch·ª©c nƒÉng ghi √¢m. Vui l√≤ng s·ª≠ d·ª•ng Chrome, Edge ho·∫∑c Firefox.");
            }
            
            // T·∫£i danh s√°ch gi·ªçng ƒë·ªçc
            loadVoices();
            
            // M·ªôt s·ªë tr√¨nh duy·ªát c·∫ßn th·ªùi gian ƒë·ªÉ t·∫£i gi·ªçng ƒë·ªçc
            speechSynthesis.onvoiceschanged = loadVoices;
            
            // X·ª≠ l√Ω thay ƒë·ªïi gi·ªçng ƒë·ªçc
            document.getElementById('voiceSelect').addEventListener('change', function() {
                const voiceName = this.value;
                selectedVoice = voices.find(voice => voice.name === voiceName) || null;
            });
            
            // Hi·ªÉn th·ªã t·∫•t c·∫£ c√¢u h·ªèi ban ƒë·∫ßu
            displayQuestions();
            
            // X·ª≠ l√Ω s·ª± ki·ªán thay ƒë·ªïi ch·ªß ƒë·ªÅ
            document.getElementById('topicSelect').addEventListener('change', function() {
                displayQuestions(this.value);
            });
        });
    </script>
</body>
</html>
